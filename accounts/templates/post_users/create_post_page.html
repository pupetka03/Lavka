<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FX</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <script src="https://cdn.tailwindcss.com"></script>
    
</head>
<body>

    {% load number_filters %}
    {% include "nav_bar.html" %}

            <div class="main-content">
            <!-- Перемикач фідів -->
            <div class="feed-switcher">
                <div class="feed-tab active" data-feed="feed1">Hlavna stranka</div>
            </div>

            <!-- Перший фід -->
                <div class="new-post-form">
                    <form method="POST" action="{% url 'create_publication' %}">
                        {% csrf_token %}
                        <input type="text" name="title" placeholder="Názov" class="post-textarea" style="font-weight: bold; padding: 5px 0; margin: 5px 0;"><br>
                        <textarea name="text" class="post-textarea" placeholder="Co sa deje?"></textarea><br>
                        <input type="text" name="tags" class="post-textarea" placeholder="Tagy (oddeli medzerou alebo cez ,)"><br>
                        <button type="submit" class="post-button">Publikovat</button>
                    </form>
                    <div style="clear: both;"></div>

                <div style="padding: 20px; text-align: center; color: #5b7083;">
 
                </div>
            </div>

 
        </div>

        <div class="sidebar-right">
            <div class="trends-block">
                <h3>Trendy tags</h3>
                {% for tag in tags %}
                <div class="trend-item">
                    <div class="trend-name">{{ tag.name }}</div>
                    <div class="trend-category">{{ tag.usage_count|humanize_k }} твітів</div>
                </div>
                {% endfor %}
            </div>
        </div>

    <!-- Модальне вікно пошуку -->
<div id="search-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-2xl w-full max-w-md mx-auto">
            <!-- Заголовок -->
            <div class="flex items-center justify-between p-4 border-b">
                <h3 class="text-lg font-bold">Hľadať</h3>
                <button id="search-close" class="text-gray-500 hover:text-gray-700 text-2xl">
                    ×
                </button>
            </div>
            
            <!-- Поле пошуку -->
            <div class="p-4">
                <input 
                    type="text" 
                    id="search-input"
                    placeholder="Zadajte vyhľadávací dopyt..."
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
            </div>
            
            <!-- Підвал -->
            <div class="p-4 border-t text-sm text-gray-500">
                Stlačením klávesu Enter spustíte vyhľadávanie
            </div>
        </div>
    </div>
</div>


</div>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        // Обробка перемикача фідів
        document.querySelectorAll('.feed-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.feed-tab').forEach(t => {
                    t.classList.remove('active');
                });
                tab.classList.add('active');
                
                document.querySelectorAll('.feed-content').forEach(content => {
                    content.classList.remove('active');
                });
                const feedId = tab.getAttribute('data-feed');
                document.getElementById(feedId).classList.add('active');
            });
        });

        // Обробка лайків
        document.querySelectorAll('.like-button').forEach(btn => {
            btn.addEventListener('click', async () => {
                const slug = btn.dataset.slug;
                const response = await fetch(`/like/${slug}/`, {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": "{{ csrf_token }}",
                        "X-Requested-With": "XMLHttpRequest"
                    }
                });
                const data = await response.json();
                btn.querySelector('.like-count').textContent = data.likes;
            });
        });

        // Пошукове модальне вікно
        const searchToggle = document.getElementById('search-toggle');
        const searchModal = document.getElementById('search-modal');
        const searchClose = document.getElementById('search-close');
        const searchInput = document.getElementById('search-input');
        const searchForm = document.getElementById('search-form');

        // Відкриття пошуку
        if (searchToggle) {
            searchToggle.addEventListener('click', (e) => {
                e.preventDefault();
                searchModal.classList.remove('hidden');
                searchInput.focus();
            });
        }

        // Закриття пошуку
        if (searchClose) {
            searchClose.addEventListener('click', () => {
                searchModal.classList.add('hidden');
                searchInput.value = '';
            });
        }

        // Закриття по кліку на фон
        if (searchModal) {
            searchModal.addEventListener('click', (e) => {
                if (e.target === searchModal) {
                    searchModal.classList.add('hidden');
                    searchInput.value = '';
                }
            });
        }

        // Закриття по Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && searchModal && !searchModal.classList.contains('hidden')) {
                searchModal.classList.add('hidden');
                searchInput.value = '';
            }
        });

        // Відправка форми по Enter
        if (searchInput) {
    searchInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            const searchQuery = searchInput.value.trim();
            if (searchQuery) {
                // Переходимо на сторінку пошуку з параметром в URL
                const baseUrl = window.location.origin; // отримуємо http://localhost:8000
                window.location.href = `${baseUrl}/search/${encodeURIComponent(searchQuery)}/`;
                
            }
        }
    });
}
    });





</script>

</body>
</html>