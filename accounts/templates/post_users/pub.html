<!DOCTYPE html>
<html lang="uk">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>FX</title>
		{% load static %}
		<link rel="stylesheet" href="{% static 'css/main.css' %}" />
		<link rel="stylesheet" href="{% static 'css/pub.css' %}" />
		{%include "feed/modal_parts/comments_window_push.html"%}
		<head>
    		{% load static %}
    		<meta name="csrf-token" content="{{ csrf_token }}">
			<script src="{% static 'js/push_comments.js' %}"></script>
		</head>
		<script src="https://cdn.tailwindcss.com"></script>
	</head>
	<body>
		{% load number_filters %} {% include "nav_bar.html" %}

		<div class="main-content">
			<!-- ĞŸĞµÑ€ĞµĞ¼Ğ¸ĞºĞ°Ñ‡ Ñ„Ñ–Ğ´Ñ–Ğ² -->
			<div class="feed-switcher">
				<div class="feed-tab active" data-feed="feed1">Lavka</div>
			</div>

			<!-- ĞŸĞµÑ€ÑˆĞ¸Ğ¹ Ñ„Ñ–Ğ´ -->
			<div id="feed1" class="feed-content active">
				<main class="max-w-4xl mx-auto px-4 py-8">
					<div class="publication-wrapper">
						<div class="post-content">
							<!-- Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ğ¿ÑƒĞ±Ğ»Ñ–ĞºĞ°Ñ†Ñ–Ñ— -->
							<div class="post-header">
								<div class="post-author-info">
									<div class="author-avatar">
										{{ pub.user.username|first|upper }}
									</div>
									<div class="author-details">
										<div class="post-author">{{ pub.title }} <span class="post-handle">@{{ pub.user.username }}</span></div>
										<div class="post-time">{{ pub.created_at|timesince }} pred</div>
									</div>
								</div>
								<div class="post-actions">
									<button class="action-btn more-btn">â‹¯</button>
								</div>
							</div>

							<!-- Ğ¢ĞµĞºÑÑ‚ Ğ¿ÑƒĞ±Ğ»Ñ–ĞºĞ°Ñ†Ñ–Ñ— -->
							<div class="post-text">{{ pub.text }}</div>

							<!-- Ğ¢ĞµĞ³Ğ¸ -->
							{% if pub.tags.all %}
							<div class="post-tags">
								{% for tag in pub.tags.all %}
								<span class="tag">#{{ tag.name }}</span>
								{% endfor %}
							</div>
							{% endif %}

							<!-- Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° -->
							<div class="post-stats">
								{% if request.user.is_authenticated %}

								<a class="stat-link comment-link comments-toggle-btn-origin" data-slug="{{ pub.slug }}">
    								<span class="stat-icon">ğŸ’¬</span>
    								<span class="stat-count">{{ pub.comments.count }}</span>
								</a>
								{% else %}
								<a class="stat-link comment-link">
									<span class="stat-icon">ğŸ’¬</span>
									<span class="stat-count">{{ pub.comments.count }}</span>
								</a>
								{% endif %}

								<span class="like-button stat-link" data-slug="{{ pub.slug }}">
									<span class="stat-icon">â¤ï¸</span>
									<span class="like-count stat-count">{{ pub.likes.count }}</span>
								</span>

								<button class="stat-link share-btn">
									<span class="stat-icon">â†—ï¸</span>
									<span class="stat-count">ZdieÄ¾aÅ¥</span>
								</button>

								<div class="like-button stat-link">
									<a href="{% url 'home_page' %}" class="inline-block bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-2 rounded-lg transition">
										â† SpÃ¤Å¥ do hlavnej stranke
									</a>
								</div>
							</div>
						</div>

						<!-- ĞšĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ– -->
						{% if pub.comments.all %}
						<div class="comments-container">
							<div class="comments-header">
								<h4>Komentare ({{ pub.comments.count }})</h4>
							</div>

							{% for comment in pub.comments.all %} {% if not comment.parent %}
							<div class="comment-thread">
								<div class="comment-section-wrapper">
									<div class="comment-header">
										<div class="comment-author-avatar">
											{{ comment.user.username|first|upper }}
										</div>
										<div class="comment-author-info">
											<span class="comment-author">{{ comment.user.username }}</span>
											<span class="comment-time">{{ comment.created_at|timesince }} pred</span>
										</div>
									</div>
									<div class="comment-text">{{ comment.text }}</div>
									<div class="comment-actions">
										{% if request.user.is_authenticated %}
										<!-- <a href="{% url 'create_reply' pub.slug comment.id %}" class="reply-btn">OdpoveÄ</a> -->
										<a class="stat-link comment-link comments-toggle-btn-origin reply-btn"
   											data-slug="{{ pub.slug }}"
   											data-parent="{{ comment.id }}">
    											OdpoveÄ
										</a>
										{% else %}
										<a class="reply-btn">OdpoveÄ</a>
										{% endif %}
										<button class="comment-like-btn" data-comment-id="{{comment}}">â™¡ <span class="comment-like-count">{{ comment.likes.count }}</span></button>
									</div>
								</div>

								{% for reply in comment.replies.all %} {% include "post_users/_replies.html" with reply=reply %} {% endfor %}
							</div>
							{% endif %} {% endfor %}
						</div>
						{% endif %}
					</div>
				</main>
			</div>
		</div>

		<div class="sidebar-right">
			<div class="trends-block">
				<h3>Trendy tags</h3>
				{% for tag in tags %}
				<div class="trend-item">
					<div class="trend-name">{{ tag.name }}</div>
					<div class="trend-category">{{ tag.usage_count|humanize_k }} publikÃ¡ciÃ­</div>
				</div>
				{% endfor %}
			</div>
		</div>

		<!-- ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğµ Ğ²Ñ–ĞºĞ½Ğ¾ Ğ¿Ğ¾ÑˆÑƒĞºÑƒ -->
		<div id="search-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
			<div class="flex items-center justify-center min-h-screen p-4">
				<div class="bg-white rounded-2xl w-full max-w-md mx-auto">
					<!-- Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº -->
					<div class="flex items-center justify-between p-4 border-b">
						<h3 class="text-lg font-bold">HÄ¾adaÅ¥</h3>
						<button id="search-close" class="text-gray-500 hover:text-gray-700 text-2xl">
							Ã—
						</button>
					</div>

					<!-- ĞŸĞ¾Ğ»Ğµ Ğ¿Ğ¾ÑˆÑƒĞºÑƒ -->
					<div class="p-4">
						<input
							type="text"
							id="search-input"
							placeholder="Zadajte vyhÄ¾adÃ¡vacÃ­ dopyt..."
							class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
						/>
					</div>

					<!-- ĞŸÑ–Ğ´Ğ²Ğ°Ğ» -->
					<div class="p-4 border-t text-sm text-gray-500">
						StlaÄenÃ­m klÃ¡vesu Enter spustÃ­te vyhÄ¾adÃ¡vanie
					</div>
				</div>
			</div>
		</div>

		<script>
			document.addEventListener("DOMContentLoaded", () => {
			    // ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° Ğ»Ğ°Ğ¹ĞºÑ–Ğ² Ğ´Ğ»Ñ Ğ¿ÑƒĞ±Ğ»Ñ–ĞºĞ°Ñ†Ñ–Ğ¹
			    document.querySelectorAll('.like-button').forEach(btn => {
			        btn.addEventListener('click', async () => {
			            const slug = btn.dataset.slug;
			            const icon = btn.querySelector('.stat-icon');

			            // ĞĞ½Ñ–Ğ¼Ğ°Ñ†Ñ–Ñ
			            icon.classList.add('liked');
			            setTimeout(() => icon.classList.remove('liked'), 400);

			            const response = await fetch(`/like/${slug}/`, {
			                method: "POST",
			                headers: {
			                    "X-CSRFToken": "{{ csrf_token }}",
			                    "X-Requested-With": "XMLHttpRequest"
			                }
			            });
			            const data = await response.json();
			            btn.querySelector('.like-count').textContent = data.likes;
			        });
			    });

			    // ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° Ğ»Ğ°Ğ¹ĞºÑ–Ğ² Ğ´Ğ»Ñ ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ–Ğ²
			    document.querySelectorAll('.comment-like-btn, .reply-like-btn').forEach(btn => {
			        btn.addEventListener('click', async () => {
			            const commentId = btn.dataset.commentId;
			            const icon = btn.querySelector('span:first-child');

			            // ĞĞ½Ñ–Ğ¼Ğ°Ñ†Ñ–Ñ
			            icon.classList.add('liked');
			            setTimeout(() => icon.classList.remove('liked'), 400);

			            console.log('Like comment:', commentId);
			        });
			    });

			    // ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ "ĞŸĞ¾Ğ´Ñ–Ğ»Ğ¸Ñ‚Ğ¸ÑÑ"
			    document.querySelectorAll('.share-btn').forEach(btn => {
			        btn.addEventListener('click', () => {
			            console.log('Share publication');
			        });
			    });

			    // ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ "Ğ‘Ñ–Ğ»ÑŒÑˆĞµ"
			    document.querySelectorAll('.more-btn').forEach(btn => {
			        btn.addEventListener('click', (e) => {
			            console.log('More options');
			            e.stopPropagation();
			        });
			    });
			});
		</script>
	</body>
</html>
