{% load static %}
{% for pub in publications %}
<div class="publication-wrapper" id="pub-{{ pub.slug }}">
    <div>
        <div class="post-author">
            <a href="{% url 'profile' pub.user.username %}" class="user-avatar">
                {{ pub.user.username|first|upper }}
            </a>
            {{ pub.title }}
            <span class="post-handle">@{{ pub.user.username }}</span>
        </div>

        <div class="post-text">
            <a href="{% url 'pub' pub.slug %}" style="text-decoration:none; color:inherit; cursor:pointer;">
                {{ pub.text }}
            </a>
        </div>
        
        <div class="post-tags">
            {% for tag in pub.tags.all %}
            <span class="tag">#{{ tag }}</span>
            {% endfor %}
        </div>
        
        <div class="post-stats">
            {% if request.user.is_authenticated %}
                <button type="button" class="comments-toggle-btn-origin" data-slug="{{ pub.slug }}">
                    ğŸ’¬ {{ pub.comments.count }}
                </button>
            {% else %}
                <span style="color:inherit; cursor:default;">
                    ğŸ’¬ {{ pub.comments.count }}
                </span>
            {% endif %}
            
            <span class="like-button" data-slug="{{ pub.slug }}" style="cursor:pointer;">
                â¤ï¸ <span class="like-count">{{ pub.likes.count }}</span>
            </span>
        </div>
    </div>

    {% for comment in pub.comments.all|slice:":3" %} 
        {% if not comment.parent %}
        <div class="comment-section-wrapper">
            <div class="comment-item">
                <div class="comment-author">
                    <a href="{% url 'profile' comment.user.username %}" class="user-avatar comment-avatar">
                        {{ comment.user.username|first|upper }}
                    </a>
                    {{ comment.user }}
                    <span class="post-handle">@{{ comment.user }}</span>
                </div>
                <div class="comment-text">{{ comment.text }}</div>
            </div>
        </div>
        {% endif %} 
    {% endfor %}
</div>
{% endfor %}